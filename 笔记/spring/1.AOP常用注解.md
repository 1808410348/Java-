#### Aop常用注解

@Before：前置通知：目标方法之前执行

@After：后置通知：目标方法之后执行（始终执行）

@AfterReturning：返回后通知：执行方法结束前执行（异常不执行）

@AfterThrowing：异常通知：出现异常时候执行

@Around：环绕通知：环绕目标方法执行

既然知道spring，那一定有必要了解全部通知顺序springboot或springboot2对aop的执行顺序的影响。

通过代码来理解AOP通知代码

```java
// 接口CalcService
package com.romanticLei.spring;

public interface CalcService {
    public int div(int x, int y);
}
```

```java
// 接口实现类CalcServiceImpl新加@Service
package com.romanticLei.spring;

import org.springframework.stereotype.Service;

@Service
public class CalcServiceImpl implements CalcService {

    @Override
    public int div(int x, int y) {
        int result = x / y;
        System.out.println("=========>CalcServiceImpl" + result);
        return result;
    }
}
```

```java
// 在除法方法前后置入各种通知，引入切面编程
package com.romanticlei.study.interview.spring.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.springframework.stereotype.Component;

// 指定一个类为切面类
@Aspect
// 纳入spring容器管理
@Component
public class MyAspect {

    @Before("execution(public int com.romanticlei.study.interview.spring.aop.CalcServiceImpl.*(..))")
    public void beforeNotify(){
        System.out.println("*********@Before 我是前置通知MyAspect");
    }

    @After("execution(public int com.romanticlei.study.interview.spring.aop.CalcServiceImpl.*(..))")
    public void afterNotify(){
        System.out.println("*********@After 我是后置通知MyAspect");
    }

    @AfterReturning("execution(public int com.romanticlei.study.interview.spring.aop.CalcServiceImpl.*(..))")
    public void afterReturningNotify(){
        System.out.println("*********@AfterReturning 我是返回后通知MyAspect");
    }

    @AfterThrowing("execution(public int com.romanticlei.study.interview.spring.aop.CalcServiceImpl.*(..))")
    public void afterThrowingNotify(){
        System.out.println("*********@AfterThrowing 我是异常通知MyAspect");
    }

    @Around("execution(public int com.romanticlei.study.interview.spring.aop.CalcServiceImpl.*(..))")
    public Object aroundNotify(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        Object retValue = null;
        System.out.println("我是环绕通知之前 AAA");
        retValue = proceedingJoinPoint.proceed();
        System.out.println("我是环绕通知之后 BBB");
        return retValue;
    }
}
```

基于 springboot1.5.9 ，我们会发现它内部集成的是Spring4.3.13

编写测试类

```java
package com.romanticlei.study.interview;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.SpringBootVersion;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.core.SpringVersion;
import org.springframework.test.context.junit4.SpringRunner;

import javax.annotation.Resource;

@SpringBootTest
@RunWith(SpringRunner.class)
public class InterviewApplicationTests {

    @Resource
    private CalcService calcService;

    @Test
    public void testAop(){
        System.out.println("Spring 版本" + SpringVersion.getVersion() + "\n SpringBoot 版本" + SpringBootVersion.getVersion());

        System.out.println();
        /**
         * 我是环绕通知之前 AAA
         * *********@Before 我是前置通知MyAspect
         * =========>CalcServiceImpl5
         * 我是环绕通知之后 BBB
         * *********@After 我是后置通知MyAspect
         * *********@AfterReturning 我是返回后通知MyAspect
         *
         * Process finished with exit code 0
         */
        calcService.div(10, 2);

        /**
         *我是环绕通知之前 AAA
         * *********@Before 我是前置通知MyAspect
         * *********@After 我是后置通知MyAspect
         * *********@AfterThrowing 我是异常通知MyAspect
         */
        calcService.div(10, 0);

    }

}
```





基于springboot1.5.9的POM包如下：

```java
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <!--<version>2.4.0</version>-->
        <version>1.5.9.RELEASE</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>

    <groupId>com.romanticLei.study</groupId>
    <artifactId>interview</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>interview</name>
    <description>Demo project for Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-core</artifactId>
            <version>1.1.3</version>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-access</artifactId>
            <version>1.1.3</version>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <version>1.1.3</version>
        </dependency>
        <!-- web+actuator -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-pool2</artifactId>
        </dependency>
        <!-- jedis -->
        <dependency>
            <groupId>redis.clients</groupId>
            <artifactId>jedis</artifactId>
            <version>3.1.0</version>
        </dependency>
        <!-- springboot-aop 技术 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-aop</artifactId>
        </dependency>
        <!-- redisson -->
        <dependency>
            <groupId>org.redisson</groupId>
            <artifactId>redisson</artifactId>
            <version>3.13.4</version>
        </dependency>
        <!-- 一般通用基础配置 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter</artifactId>
            <version>RELEASE</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project>
```











